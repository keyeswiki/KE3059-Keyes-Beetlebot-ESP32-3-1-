# 项目16 读取APP按钮字符串

## 1.实验简介：
在前面的实验中，我们已经了解了ESP32的WIFI Station模式，WIFI AP模式和WIFI AP+Station模式等三种模式。
在本实验中，我们先使用ESP32的WIFI Station模式通过APP连接WIFI来读取APP上各功能按钮发送的字符。

## 2.安装APP

**安卓系统设备（手机/平板）APP：**

1.下载Beetlebot.apk文件

A. 我们提供了Android APP 的安装包：
![Img](/media/img-20230425082506.png)
现将文件夹中的Beetlebot.apk文件转移到安卓系统手机或平板上。

B. 或者使用手机浏览器中的扫描功能去扫二维码下载APP。
![Img](/media/img-20230506145736.png)

2.点击Beetlebot.apk文件进入安装页面，点击“允许”按钮，然后再点击“继续安装”按钮，安装完成后点击“打开”按钮就可以进入APP界面。
![Img](/media/img-20230506150200.png)
![Img](/media/img-20230506150422.png)
![Img](/media/img-20230506150539.png)
![Img](/media/img-20230330152214.png)

**IOS系统设备（手机/iPad）APP**
a.打开App Store。
![Img](/media/img-20230330152300.png)
b.在搜索框输入“**Beetlebot**”，点击搜索，出现下载界面，点击“![Img](/media/img-20230330152329.png)”，就可以下载安装Beetlebot的APP。接下来的操作和安卓系统类似的，可以参考上面安卓系统的步骤进行操作。

## 3.实验代码：

```
//*************************************************************************************
/*
项目16：读取APP按钮字符串
*/

// generated by KidsBlock
#include <Arduino.h>
#include <WiFi.h>
#include <ESPmDNS.h>
#include <WiFiClient.h>

String item = "0";
const char* ssid = "ChinaNet-2.4G-0DF0";
const char* password = "ChinaNet@233";
WiFiServer server(80);

void setup() {
  Serial.begin(115200);
  WiFi.begin(ssid, password);
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }
  Serial.println("");
  Serial.print("Connected to ");
  Serial.println(ssid);
  Serial.print("IP address: ");
  Serial.println(WiFi.localIP());
  server.begin();
  Serial.println("TCP server started");
  MDNS.addService("http", "tcp", 80);
}

void loop() {
  WiFiClient client = server.available();
  if (!client) {
      return;
  }
  while(client.connected() && !client.available()){
      delay(1);
  }
  String req = client.readStringUntil('\r');
  int addr_start = req.indexOf(' ');
  int addr_end = req.indexOf(' ', addr_start + 1);
  if (addr_start == -1 || addr_end == -1) {
      Serial.print("Invalid request: ");
      Serial.println(req);
      return;
  }
  req = req.substring(addr_start + 1, addr_end);
  item=req;
  Serial.println(item);
  String s;
  if (req == "/")
  {
      IPAddress ip = WiFi.localIP();
      String ipStr = String(ip[0]) + '.' + String(ip[1]) + '.' + String(ip[2]) + '.' + String(ip[3]);
      s = "HTTP/1.1 200 OK\r\nContent-Type: text/html\r\n\r\n<!DOCTYPE HTML>\r\n<html>Hello from ESP32 at ";
      s += ipStr;
      s += "</html>\r\n\r\n";
      Serial.println("Sending 200");
      client.println(s);
  }
  //client.print(s);
  client.stop();
}
//*************************************************************************************
```
<span style="color: rgb(255, 76, 65);">特别注意：</span>需要先将实验代码![Img](/media/img-20230330152503.png)中的用户Wifi名称和用户Wifi密码改成你们自己的Wifi名称和Wifi密码。

## 4.实验现象：
编译并上传代码到ESP32主板上（<span style="color: rgb(255, 76, 65);">如果上传代码不成功，可以在点击![Img](/media/img-20230330092521.png)后用手按住ESP32主板上的Boot键，出现上传进度百分比再松开Boot键![Img](/media/img-20230331144331.png)</span>），利用USB线上电后，再打开串口监视器![Img](/media/img-20230330103640.png)，设置波特率为115200，这样，串口监视器打印检测到的WiFi IP地址，然后打开WiFi APP。在WIFI按钮前面的文本框中输入检测到的WIFI IP地址（例如，下面串口监视器检测到的IP地址：192.168.1.137），再切换WiFi按钮来连接WiFi（白色WIFI按钮变成绿色WIFI按钮），同时WiFi IP地址前的文本框中会显示对应的WiFi IP地址“192.168.1.137”。这样，就说明APP已经连接上了WiFi。
![Img](/media/img-20230330152622.png)
用手分别点击APP上的各个功能按钮，然后串口监视器会打印接收到的对应字符。(<span style="color: rgb(255, 76, 65);">如果打开串口监视器且设置波特率为115200之后，串口监视器窗口没有显示如下信息，可以按下ESP32主板上的复位键![Img](/media/img-20230330150217.png)
</span>）
![Img](/media/img-20230330153222.png)






